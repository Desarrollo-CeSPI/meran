/*
 * Meran - MERAN UNLP is a ILS (Integrated Library System) wich provides Catalog,
 * Circulation and User's Management. It's written in Perl, and uses Apache2
 * Web-Server, MySQL database and Sphinx 2 indexing.
 * Copyright (C) 2009-2013 Grupo de desarrollo de Meran CeSPI-UNLP
 *
 * This file is part of Meran.
 *
 * Meran is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Meran is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Meran.  If not, see <http://www.gnu.org/licenses/>.
 */

function clear_fatal_error(){$("#nivel1Tabla").html(""),$("#nivel2Tabla").html(""),$("#nivel3Tabla").html(""),$("#nivel1").html("")}function agregarAHash(e,a,o){e[a]=o}function objeto_params(){}function inicializarSideLayers(){for(arreglo=$("#nivel2>fieldset legend"),x=0;x<arreglo.length;x++)$(arreglo[x]).removeClass("activeLayer"),$(arreglo[x]).addClass("nivel2Selected")}function toggleClass(e){inicializarSideLayers(),$(e).addClass("activeLayer")}function inicializar(){_freeMemory(MARC_OBJECT_ARRAY),MARC_OBJECT_ARRAY=[],_freeMemory(BARCODES_ARRAY),BARCODES_ARRAY=[],TAB_INDEX=0,EDICION_N3_GRUPAL=0,$("#datos_del_leader").hide()}function _freeMemory(e){for(var a=0;a<e.length;a++)delete e[a]}function _existeEnArray(e,a){for(var o=0,t=0;t<e.length;t++)if(jQuery.trim(e[t])==jQuery.trim(a)&&++o>1)return 1;return 0}function verificarAgregarDocumentoN3(){var e=new Array,a=0;if(_getBarcodes()){for(var o=0;o<BARCODES_ARRAY.length;o++)_existeEnArray(BARCODES_ARRAY,BARCODES_ARRAY[o])&&(a=1,e.push(BARCODES_ARRAY[o]));if(a)return jAlert(HAY_BARCODES_REPETIDOS,CATALOGO_ALERT_TITLE),0}return 1}function _setFoco(){$("[tabindex='1']")[0]&&$("[tabindex='1']")[0].focus()}function seleccionoAlgo(e){var a=$("input[name="+e+"]:checked");new Array;return 0==a.length?(jAlert(ELIJA_AL_MENOS_UN_EJEMPLAR,CATALOGO_ALERT_TITLE),0):1}function _getIdComponente(e,a){for(var o=0;o<MARC_OBJECT_ARRAY.length;o++){var t=MARC_OBJECT_ARRAY[o];if(t.getCampo()==e)for(var r=t.getSubCamposArray(),i=0;i<r.length;i++)if(r[i].getSubCampo()==a)return r[i].getIdCompCliente()}return 0}function _getPosBySubCampoMARC_conf_ById(e){for(var a=0;a<MARC_OBJECT_ARRAY.length;a++)for(var o=MARC_OBJECT_ARRAY[a].getSubCamposArray(),t=0;t<o.length;t++)if(o[t].getIdCompCliente()==e)return t;return 0}function _getSubCampoMARC_conf_ById(e){for(var a=0;a<MARC_OBJECT_ARRAY.length;a++)for(var o=MARC_OBJECT_ARRAY[a].getSubCamposArray(),t=0;t<o.length;t++)if(o[t].getIdCompCliente()==e)return o[t];return 0}function _getCampoMARC_conf_ById(e){for(var a=0;a<MARC_OBJECT_ARRAY.length;a++)if(MARC_OBJECT_ARRAY[a].getIdCompCliente()==e)return MARC_OBJECT_ARRAY[a];return 0}function _getIndexCampoMARC_conf_ById(e){for(var a=0;a<MARC_OBJECT_ARRAY.length;a++)if(MARC_OBJECT_ARRAY[a].getIdCompCliente()==e)return a;return-1}function removeFromArray(e,a,o){var t=e.slice((o||a)+1||e.length);return e.length=a<0?e.length+a:a,e.push.apply(e,t)}function _getBarcodes(){var e=$("#"+_getIdComponente("995","f")).val();return _freeMemory(BARCODES_ARRAY),BARCODES_ARRAY=[],void 0!==e&&""!=e?(BARCODES_ARRAY=e.split(","),1):0}function _sacarOpciones(){for(var e=0;e<MARC_OBJECT_ARRAY.length;e++)for(var a=MARC_OBJECT_ARRAY[e].getSubCamposArray(),o=0;o<a.length;o++)a[o].opciones&&a[o].opciones.length>0&&(a[o].opciones=[])}function _clearDataFromComponentesArray(){for(var e=0;e<MARC_OBJECT_ARRAY.length;e++)MARC_OBJECT_ARRAY[e].dato="",$("#"+MARC_OBJECT_ARRAY[e].idCompCliente).val("")}function data_sanitize(e){return null!=e&&(e=e.replace(/"/g,"")),e}function _clearContentsEstructuraDelNivel(){$("#estructuraDelNivel1").html(""),$("#estructuraDelNivel2").html(""),$("#estructuraDelNivel3").html("")}function _showAndHiddeEstructuraDelNivel(e){0==e?($("#nivel1Tabla").hide(),$("#nivel2Tabla").hide(),$("#nivel3Tabla").hide()):1==e?($("#nivel1Tabla").show(),$("#nivel2Tabla").hide(),$("#nivel3Tabla").hide()):2==e?($("#nivel2Tabla").show(),$("#nivel1Tabla").hide(),$("#nivel3Tabla").hide()):3==e&&($("#nivel3Tabla").show(),$("#nivel1Tabla").hide(),$("#nivel2Tabla").hide())}function syncComponentesArray(){for(var e=0;e<MARC_OBJECT_ARRAY.length;e++){var a=MARC_OBJECT_ARRAY[e].getSubCamposArray(),o=MARC_OBJECT_ARRAY[e].subcampos_hash,t="";MARC_OBJECT_ARRAY[e].cant_subcampos=0,MARC_OBJECT_ARRAY[e].indicador_primario=$("#select_indicador_primario"+e).val(),MARC_OBJECT_ARRAY[e].indicador_secundario=$("#select_indicador_secundario"+e).val();for(var r=0;r<a.length;r++)t=new Object,"1"==a[r].getReferencia()?""!=$("#"+a[r].getIdCompCliente()).val()&&"combo"==a[r].getTipo()?(a[r].setDato($("#"+a[r].getIdCompCliente()).val()),t[a[r].getSubCampo()]=$("#"+a[r].getIdCompCliente()).val()):""!=$("#"+a[r].getIdCompCliente()).val()&&"auto"==a[r].getTipo()?(a[r].setDato($("#"+a[r].getIdCompCliente()+"_hidden").val()),a[r].setDatoReferencia($("#"+a[r].getIdCompCliente()).val()),t[a[r].getSubCampo()]=$("#"+a[r].getIdCompCliente()+"_hidden").val()):(a[r].datoReferencia="NULL",a[r].setDato($("#"+a[r].getIdCompCliente()).val()),t[a[r].getSubCampo()]="NULL"):(a[r].setDato($("#"+a[r].getIdCompCliente()).val()),t[a[r].getSubCampo()]=$("#"+a[r].getIdCompCliente()).val()),o[r]=t;MARC_OBJECT_ARRAY[e].cant_subcampos=a.length}}function getDivDelNivel(){switch(_NIVEL_ACTUAL){case 1:return"estructuraDelNivel1";case 2:return"estructuraDelNivel2";case 3:return"estructuraDelNivel3"}}function mostrarEstructuraDelNivel1(){_NIVEL_ACTUAL=1,0==MODIFICAR&&"AGREGAR_ANALITICA"!=ACTION&&_mostrarAccion("<h4>Agregando registro con el esquema: "+$("#tipo_nivel3_id option:selected").html()+" ("+TEMPLATE_ACTUAL+")</h4>"+crearBotonEsquema()),objAH=new AjaxHelper(updateMostrarEstructuraDelNivel1),objAH.debug=!0,objAH.showOverlay=!0,objAH.showState=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="MOSTRAR_ESTRUCTURA_DEL_NIVEL",objAH.nivel=_NIVEL_ACTUAL,objAH.id_tipo_doc=TEMPLATE_ACTUAL,objAH.sendToServer()}function updateMostrarEstructuraDelNivel1(e){var a=JSONstring.toObject(e).Message_arrayref;1==setMessages(a)?clear_fatal_error():(_clearContentsEstructuraDelNivel(),_showAndHiddeEstructuraDelNivel(1),procesarInfoJson(JSONstring.toObject(e),null),validateForm("formNivel1",guardarModificarDocumentoN1),scrollTo("nivel1Tabla"),$(".hasDatepicker").datepicker())}function mostrarEstructuraDelNivel2(){_NIVEL_ACTUAL=2,0==MODIFICAR&&"AGREGAR_ANALITICA"!=ACTION&&_mostrarAccion("<h4>Agregando Nivel 2 con el esquema: "+$("#tipo_nivel3_id option:selected").html()+" ("+TEMPLATE_ACTUAL+")</h4>"+crearBotonEsquema()),objAH=new AjaxHelper(updateMostrarEstructuraDelNivel2),objAH.debug=!0,objAH.showOverlay=!0,objAH.showOverlay=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="MOSTRAR_ESTRUCTURA_DEL_NIVEL",objAH.nivel=2,objAH.id_tipo_doc=TEMPLATE_ACTUAL,objAH.sendToServer()}function updateMostrarEstructuraDelNivel2(e){var a=JSONstring.toObject(e).Message_arrayref;1==setMessages(a)?clear_fatal_error():(_clearContentsEstructuraDelNivel(),_showAndHiddeEstructuraDelNivel(2),procesarInfoJson(JSONstring.toObject(e),null),validateForm("formNivel2",guardarModificarDocumentoN2),MODIFICAR||(0==ID_TIPO_EJEMPLAR?$("#"+_getIdComponente("910","a")).val($("#tipo_nivel3_id").val()):$("#"+_getIdComponente("910","a")).val(ID_TIPO_EJEMPLAR)),scrollTo("nivel2Tabla"),$(".hasDatepicker").datepicker())}function _seleccionarTipoDocumentoYDeshabilitarCombo(){1==MODIFICAR&&(id=_getIdComponente("910","a"),$("#"+id).val($("#tipo_nivel3_id").val()),$("#"+id).attr("disabled","true"))}function mostrarEstructuraDelNivel3(e){_NIVEL_ACTUAL=3,objAH=new AjaxHelper(updateMostrarEstructuraDelNivel3),objAH.debug=!0,objAH.showOverlay=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="MOSTRAR_ESTRUCTURA_DEL_NIVEL",objAH.nivel=_NIVEL_ACTUAL,objAH.id_tipo_doc=e||$("#tipo_nivel3_id").val(),objAH.sendToServer()}function updateMostrarEstructuraDelNivel3(e){var a=JSONstring.toObject(e).Message_arrayref;if(1==setMessages(a))clear_fatal_error();else{if(_clearContentsEstructuraDelNivel(),_showAndHiddeEstructuraDelNivel(3),TAB_INDEX=0,procesarInfoJson(JSONstring.toObject(e),null),scrollTo("nivel3Tabla"),$("#cantEjemplares").val()>0&&$("#"+_getIdComponente("995","f")).removeClass("required"),validateForm("formNivel3",guardarModificarDocumentoN3),0==MODIFICAR){var o=_getIdComponente("995","f");$("#"+o).click(function(){registrarToggleOnChangeForBarcode(o)})}0==EDICION_N3_GRUPAL||$("#nivel3Tabla").before("<div class='alert alert-heading'>Registro: <a href='detalle.pl?id1="+REGISTRO_ID+"&amp;token='"+TOKEN+"' title='Ver Detalle del Registro'>"+REGISTRO_ID+"</a> <br> Complete s√≥lo los campos que desee modificar</div>")}$(".hasDatepicker").datepicker()}function switchTipoBarcode(e,a){a.val(""),a.attr("readonly",!0),a.removeClass("required"),e.val(""),e.removeAttr("readonly"),e.focus()}function registrarToggleOnChangeForBarcode(e){var a=$("#cantEjemplares"),o=$.trim(a.val()),t=_getIdComponente("995","f"),r=$("#"+t),i=$.trim(r.val());e?o.length>0?bootbox.confirm(BORRAR_CANTIDAD_DE_EJEMPLARES,function(e){e&&(switchTipoBarcode(r,a),$("#cantEjemplares").removeClass("required"),$("#"+_getIdComponente("995","f")).addClass("required"),$("#"+_getIdComponente("995","f")).attr("readonly",!1))}):switchTipoBarcode(r,a):i.length>0?bootbox.confirm(BORRAR_LISTA_DE_CODIGOS,function(e){e&&(switchTipoBarcode(a,r),$("#cantEjemplares").addClass("required"),$("#"+_getIdComponente("995","f")).attr("readonly",!0))}):switchTipoBarcode(a,r)}function seleccionar_esquema(){inicializar(),ID_TIPO_EJEMPLAR=$("#tipo_nivel3_id").val(),TEMPLATE_ACTUAL=$("#tipo_nivel3_id").val(),0==MODIFICAR&&_mostrarAccion("<h4>Agregando ejemplares con el esquema: "+$("#tipo_nivel3_id option:selected").html()+" ("+$("#tipo_nivel3_id").val()+")</h4>"+crearBotonEsquema()),0==TIENE_NIVEL_2&&"SIN SELECCIONAR"==$("#tipo_nivel3_id").val()&&(jAlert(SELECCIONE_EL_ESQUEMA,CATALOGO_ALERT_TITLE),$("#tipo_nivel3_id").focus()),"SIN SELECCIONAR"==$("#tipo_nivel3_id").val()&&(jAlert(SELECCIONE_EL_ESQUEMA,CATALOGO_ALERT_TITLE),$("#tipo_nivel3_id").focus()),1==MODIFICAR||(close_esquema(),MODIFICAR=0,AGREGAR_COMPLETO=0,1==_NIVEL_ACTUAL?mostrarEstructuraDelNivel1():2==_NIVEL_ACTUAL?mostrarEstructuraDelNivel2():mostrarEstructuraDelNivel3(),inicializarSideLayers())}function guardarEsquema(){TEMPLATE_ACTUAL=$("#tipo_nivel3_id").val(),objAH=new AjaxHelper(updateGuardarEsquema),objAH.showOverlay=!0,objAH.debug=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="GUARDAR_ESQUEMA",objAH.id1=ID_N1,objAH.id2=ID_N2,objAH.id3=ID_N3,objAH.nivel=_NIVEL_ACTUAL,objAH.template=$("#tipo_nivel3_id").val(),objAH.sendToServer()}function updateGuardarEsquema(e){var a=JSONstring.toObject(e).Message_arrayref;setMessages(a),$("#datos_esquema").modal("hide"),1==_NIVEL_ACTUAL?(modificarN1(ID_N1,TEMPLATE_ACTUAL),mostrarInfoAltaNivel1(ID_N1)):2==_NIVEL_ACTUAL?(modificarN2(ID_N2,TEMPLATE_ACTUAL),mostrarInfoAltaNivel2(ID_N2)):modificarN3(ID_N3,TEMPLATE_ACTUAL)}function editarIndice(e,a){ID_N1=e,ID_N2=a,$("#datos_indice").modal({containerCss:{backgroundColor:"#fff",height:343,padding:0,width:900}})}function agregarIndice(e,a){ID_N1=e,ID_N2=a,$("#datos_indice").modal({containerCss:{backgroundColor:"#fff",height:343,padding:0,width:900}})}function mostrarIndice(e){$("#indice_data"+e).modal()}function guardarIndice(){objAH=new AjaxHelper(updateGuadarIndice),objAH.showOverlay=!0,objAH.debug=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="GUARDAR_INDICE",objAH.id2=ID_N2,objAH.indice=$("#indice_id").val(),objAH.sendToServer(),close_window_indice()}function updateGuadarIndice(e){var a=JSONstring.toObject(e).Message_arrayref;setMessages(a),window.location="detalle.pl?id1="+ID_N1}function close_window_indice(){$("#datos_indice").modal("hide")}function agregarN2(){_NIVEL_ACTUAL=2,ID_TIPO_EJEMPLAR=$("#tipo_nivel3_id").val(),MODIFICAR=0,inicializar(),open_esquema()}function completarArgregarN3(){_mostrarAccion("Agregando ejemplares"+crearBotonEsquema()),$("#divCantEjemplares").show()}function agregarN3(e,a){_NIVEL_ACTUAL=3,ID_N2=e,ID_TIPO_EJEMPLAR=a,MODIFICAR=0,inicializar(),open_esquema()}function mostrarInfoAltaNivel1(e){ID_N1=e,objAH=new AjaxHelper(updateMostrarInfoAltaNivel1),objAH.showOverlay=!0,objAH.debug=!0,objAH.showStatusIn="nivel1",objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="MOSTRAR_INFO_NIVEL1_LATERAL",objAH.id1=ID_N1,objAH.sendToServer()}function updateMostrarInfoAltaNivel1(e){0==MODIFICAR&&1==_NIVEL_ACTUAL&&($("#nivel1Tabla").slideUp("slow"),$("#estructuraDelNivel1").html("")),$("#nivel1").html(e),"N1"==scroll&&scrollTo("nivel1tabla")}function getNivel2(e){objAH=new AjaxHelper(updateMostrarInfoAltaNivel2),objAH.showOverlay=!0,objAH.debug=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="MOSTRAR_INFO_NIVEL2",objAH.id2=e,objAH.id1=ID_N1,objAH.sendToServer()}function mostrarInfoAltaNivel2(e){objAH=new AjaxHelper(updateMostrarInfoAltaNivel2),objAH.showOverlay=!0,objAH.debug=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="MOSTRAR_INFO_NIVEL2_LATERAL",objAH.id2=e,objAH.id1=ID_N1,objAH.sendToServer()}function updateMostrarInfoAltaNivel2(e){0==MODIFICAR&&2==_NIVEL_ACTUAL&&($("#nivel2Tabla").slideUp("slow"),$("#estructuraDelNivel2").html("")),$("#nivel2").html(e),"N2"==scroll&&scrollTo("nivel2tabla")}function guardarModificarDocumentoN1(){1==MODIFICAR?guardarModificacionDocumentoN1():guardarDocumentoN1()}function guardarModificarDocumentoN2(){1==MODIFICAR?guardarModificacionDocumentoN2():guardarDocumentoN2()}function guardarModificarDocumentoN3(){1==MODIFICAR?guardarModificacionDocumentoN3():guardarDocumentoN3()}function guardarDocumentoN1(){syncComponentesArray(),objAH=new AjaxHelper(updateGuardarDocumentoN1),objAH.debug=!0,objAH.showOverlay=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="GUARDAR_NIVEL_1",objAH.id_tipo_doc=TEMPLATE_ACTUAL,objAH.id_nivel_bibliografico=$("#id_nivel_bibliografico").val(),_sacarOpciones(),objAH.infoArrayNivel1=MARC_OBJECT_ARRAY,objAH.id1=ID_N1,objAH.id2_padre=ID_N2_PADRE,objAH.sendToServer()}function updateGuardarDocumentoN1(e){var a=JSONstring.toObject(e),o=a.Message_arrayref;ID_N1=a.id1,ID_N1_PADRE=ID_N1,hayError(o)?setMessages(o):(inicializar(),$("#datos_del_leader").hide(),mostrarInfoAltaNivel1(ID_N1),mostrarEstructuraDelNivel2())}function verificar_guardar_nivel2(){var e=!0;return 0==MODIFICAR&&"SIN SELECCIONAR"==$("#tipo_nivel3_id").val()&&(jAlert(SELECCIONE_EL_ESQUEMA,CATALOGO_ALERT_TITLE),$("#tipo_nivel3_id").focus(),e=!1),e}function guardarDocumentoN2(){verificar_guardar_nivel2()&&(syncComponentesArray(),objAH=new AjaxHelper(updateGuardarDocumentoN2),objAH.debug=!0,objAH.showOverlay=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="GUARDAR_NIVEL_2",objAH.id_tipo_doc=TEMPLATE_ACTUAL,objAH.tipo_ejemplar=$("#"+_getIdComponente("910","a")).val(),_sacarOpciones(),objAH.infoArrayNivel2=MARC_OBJECT_ARRAY,objAH.estantes_array=ESTANTES_SELECCIONADOS_ARRAY,objAH.id1=ID_N1,objAH.id2=ID_N2,objAH.id2_padre=ID_N2_PADRE,objAH.sendToServer())}function updateGuardarDocumentoN2(e){var a=JSONstring.toObject(e),o=a.Message_arrayref;ID_N2=a.id2,setMessages(o),hayError(o)||(inicializar(),mostrarInfoAltaNivel2(ID_N2),1==a.enable_nivel3?mostrarEstructuraDelNivel3(TEMPLATE_ACTUAL):(disableAlert(),$("#ajax-indicator").modal({show:!0,keyboard:!1,backdrop:!1}),window.location="detalle.pl?id1="+ID_N1_PADRE),1==FROM_DETALLE_REGISTRO&&(disableAlert(),$("#ajax-indicator").modal({show:!0,keyboard:!1,backdrop:!1}),window.location="detalle.pl?id1="+ID_N1))}function guardarDocumentoN3(){if(verificarAgregarDocumentoN3()){syncComponentesArray();var e=!!$("#cantEjemplares").attr("readonly");objAH=new AjaxHelper(updateGuardarDocumentoN3),objAH.debug=!0,objAH.showOverlay=!0,objAH.modificado=0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="GUARDAR_NIVEL_3",objAH.id_tipo_doc=TEMPLATE_ACTUAL,objAH.esPorBarcode=e,objAH.ui_origen=$("#"+_getIdComponente("995","d")).val(),objAH.ui_duenio=$("#"+_getIdComponente("995","c")).val(),e?objAH.BARCODES_ARRAY=BARCODES_ARRAY:objAH.cantEjemplares=$("#cantEjemplares").val(),_sacarOpciones(),objAH.infoArrayNivel3=MARC_OBJECT_ARRAY,objAH.id1=ID_N1,objAH.id2=ID_N2,objAH.sendToServer()}}function updateGuardarDocumentoN3(e){var a=JSONstring.toObject(e).Message_arrayref;setMessages(a),hayError(a)||(disableAlert(),$("#ajax-indicator").modal({show:!0,keyboard:!1,backdrop:!1}),window.location="detalle.pl?id1="+ID_N1,_freeMemory(ID3_ARRAY),ID3_ARRAY=[],_freeMemory(BARCODES_ARRAY),BARCODES_ARRAY=[],_clearDataFromComponentesArray(),mostrarInfoAltaNivel2(ID_N2),mostrarInfoAltaNivel3(ID_N2))}function guardarModificacionDocumentoN1(){syncComponentesArray(),objAH=new AjaxHelper(updateGuardarModificacionDocumentoN1),objAH.debug=!0,objAH.showOverlay=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="MODIFICAR_NIVEL_1",objAH.id_tipo_doc=TEMPLATE_ACTUAL,objAH.id_nivel_bibliografico=$("#id_nivel_bibliografico").val(),_sacarOpciones(),objAH.infoArrayNivel1=MARC_OBJECT_ARRAY,objAH.id1=ID_N1,objAH.sendToServer()}function updateGuardarModificacionDocumentoN1(e){var a=JSONstring.toObject(e).Message_arrayref;setMessages(a),hayError(a)||(inicializar(),$("#datos_del_leader").hide(),mostrarInfoAltaNivel1(ID_N1),mostrarEstructuraDelNivel2(),1==FROM_DETALLE_REGISTRO&&(disableAlert(),$("#ajax-indicator").modal({show:!0,keyboard:!1,backdrop:!1}),window.location="detalle.pl?id1="+ID_N1),MODIFICAR=0)}function guardarModificacionDocumentoN2(){syncComponentesArray(),objAH=new AjaxHelper(updateGuardarModificacionDocumentoN2),objAH.debug=!0,objAH.showOverlay=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="MODIFICAR_NIVEL_2",objAH.estantes_array=ESTANTES_SELECCIONADOS_ARRAY,_sacarOpciones(),objAH.infoArrayNivel2=MARC_OBJECT_ARRAY,objAH.tipo_ejemplar=ID_TIPO_EJEMPLAR,objAH.id1=ID_N1,objAH.id2=ID_N2,objAH.sendToServer()}function updateGuardarModificacionDocumentoN2(e){if(!verificarRespuesta(e))return 0;var a=JSONstring.toObject(e),o=a.Message_arrayref;ID_N2=a.id2,setMessages(o),hayError(o)||(inicializar(),mostrarInfoAltaNivel2(ID_N2),1==a.enable_nivel3&&mostrarEstructuraDelNivel3(TEMPLATE_ACTUAL),1==FROM_DETALLE_REGISTRO&&(disableAlert(),$("#ajax-indicator").modal({show:!0,keyboard:!1,backdrop:!1}),window.location="detalle.pl?id1="+ID_N1),MODIFICAR=0)}function guardarModificacionDocumentoN3(){syncComponentesArray(),objAH=new AjaxHelper(updateGuardarModificacionDocumentoN3),objAH.debug=!0,objAH.showOverlay=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="MODIFICAR_NIVEL_3",objAH.cantEjemplares=$("#cantEjemplares").val(),_sacarOpciones(),objAH.infoArrayNivel3=MARC_OBJECT_ARRAY,objAH.tipo_ejemplar=ID_TIPO_EJEMPLAR,objAH.id1=ID_N1,objAH.id2=ID_N2,objAH.EDICION_N3_GRUPAL=EDICION_N3_GRUPAL,objAH.ID3_ARRAY=ID3_ARRAY,objAH.sendToServer()}function updateGuardarModificacionDocumentoN3(e){var a=JSONstring.toObject(e).Message_arrayref;setMessages(a),scroll="N3";var o=$("#estructuraDelNivel3 :input");for(x=0;x<o.length;x++)o[x].value="";hayError(a)||(_freeMemory(ID3_ARRAY),ID3_ARRAY=[],_clearDataFromComponentesArray(),mostrarInfoAltaNivel3(ID_N2),1==FROM_DETALLE_REGISTRO&&(disableAlert(),$("#ajax-indicator").modal({show:!0,keyboard:!1,backdrop:!1}),window.location="detalle.pl?id1="+ID_N1),MODIFICAR=0)}function guardar(e){1==e&&$("#formNivel1").submit(),2==e&&$("#formNivel2").submit(),3==e&&$("#formNivel3").submit()}function mostrarInfoAltaNivel3(e){startOverlay(),0!=e&&(objAH=new AjaxHelper(updateMostrarInfoAltaNivel3),objAH.debug=!0,objAH.showOverlay=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="MOSTRAR_INFO_NIVEL3_TABLA",objAH.id2=e,ID_N2=e,objAH.sendToServer())}function updateMostrarInfoAltaNivel3(e){$("#divCantEjemplares").show(),$("#detalleDelNivel3").html(e),$("#ejemplares_nive2_id_"+ID_N2).html(e),zebra("tablaResult"),checkedAll("select_all","checkEjemplares"),"N3"==scroll&&scrollTo("detalleDelNivel3"),closeModal()}function mostrarInfoAltaNivel3ParaEdicionGrupalFromRegistro(e){0!=e&&(objAH=new AjaxHelper(updateMostrarInfoAltaNivel3ParaEdicionGrupalFromRegistro),objAH.debug=!0,objAH.showOverlay=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="MOSTRAR_INFO_NIVEL3_TABLA",objAH.id2=e,ID_N2=e,objAH.sendToServer())}function updateMostrarInfoAltaNivel3ParaEdicionGrupalFromRegistro(e){modificarEjemplaresN3()}function open_alta_indicador(e){$("#"+e).modal()}function close_alta_indicador(e){closeModal(e)}function open_esquema(){$("#datos_esquema").modal(),1==MODIFICAR?($("#boton_guardar_esquema").show(),$("#boton_seleccionar_esquema").hide()):($("#boton_guardar_esquema").hide(),$("#boton_seleccionar_esquema").show())}function close_esquema(){closeModal("datos_esquema")}function guardar_indicadores(e,a){var o=$("#select_indicador_primario"+a).val(),t=$("#select_indicador_secundario"+a).val();$("#indicador_primario_"+a).html(o),$("#indicador_secundario_"+a).html(t),close_alta_indicador(e),$("#select_indicador_primario"+a).val(o),$("#select_indicador_secundario"+a).val(t)}function procesarInfoJson(e,a){for(var o,t,r,i,n,l,c,s=e,d=0;d<s.length;d++){o="",t="",A=(i=new campo_marc_conf(s[d])).getSubCamposArray(),n=generarIdComponente(),+(l=generarIdComponente())+i.getCampo(),c=MARC_OBJECT_ARRAY.length,o=o+"<form id='"+l+"' class= 'modal fade hide form-horizontal well' onsubmit='return false;'>",o+='<div class="modal-header"><h3>Indicadores</h3></div>',""!=i.getIndicadorPrimario()&&(t="<div class='modal-body'><div class='control-group'><label for='"+l+"'>Indicador Primero: "+i.getIndicadorPrimario()+"</label><div class='controls'>",t+=crearSelectIndicadoresPrimarios(i,c),t+="<p class='help-inline'>Seleccione un indicador primario para el campo</p>",t+="</div></div>"),""!=i.getIndicadorSecundario()&&(t+="<div class='control-group'><label for='"+l+"'>Indicador Segundo: "+i.getIndicadorSecundario()+"</label><div class='controls'>",t+=crearSelectIndicadoresSecundarios(i,c),t+="<p class='help-block'>Seleccione un indicador secundario para el campo</p>",t+="</div></div></div>"),t=(t=(t+="<div class='modal-footer'><p style='text-align: center; margin: 0;'>")+"<button class='btn horizontal' onclick=close_alta_indicador('"+l+"');>Cancelar</button>")+"<button class='btn btn-primary horizontal' onclick='guardar_indicadores("+l+", "+d+");'>Aceptar</button></p>",o=(o=(o+="</div>")+(t+="</div>")+"</form>")+"<div id='marc_group"+n+"' class='row underline' style='width: 80%; margin-left: 0;'><li class='MARCHeader'>",o+="<div class='MARCHeader_info'>",o+="<div style='width:120px;float:left'><div class='btn-group inline'>",o+=crearBotonAyudaCampo(i.getCampo()),0!=i.getIndicadoresPrimarios()&&(o=o+"<a id='indicador_primario_"+d+"' class='btn click' onclick=open_alta_indicador('"+l+"') title='Indicadores'>"+i.getIndicadorPrimarioDato()+"</a>|"),0!=i.getIndicadoresSecundarios()&&(o=o+"<a id='indicador_secundario_"+d+"' class='btn click' onclick=open_alta_indicador('"+l+"') title='Indicadores'>"+i.getIndicadorSecundarioDato()),o=(o=(o+="</div></div>")+"<div id='trigger_"+n+"' class='MARCHeader click trigger trigger_"+n+"' style='width:80%;float:left; margin-left: 10px;'>")+"<a class='fancy_extern_link' href='http://www.loc.gov/marc/bibliographic/bd"+i.getCampo()+".html' TARGET='_blank'>"+i.getCampo()+"</a> - <h5 class='inline'>"+i.getNombre()+"</h5>","1"==i.getRepetible()?(o+="</div>",o+="<div style='float:right'>",i.setIdCompCliente("marc_group"+n),o+=openDivButtonContainer("marc_group"+n+"_buttons","campo"),o+="</div>"):o+="</div>",o=(o+="</div>")+"</li><div id='MARC_content_"+n+"' class='MARC_content_"+n+" left'>",null==a?$("#"+getDivDelNivel()).append(o):$(o).insertAfter($("#"+a)),$("#marc_group"+n+"_buttons_lista").append(crearBotonAgregarCampoRepetible(i,"marc_group"+n)),$("#marc_group"+n+"_buttons_lista").append(crearBotonEliminarCampoRepetible(i,i.getFirst())),$("#boton_eliminar_marc_group"+n).show(),$("#select_indicador_primario"+MARC_OBJECT_ARRAY.length).val(i.getIndicadorPrimarioDato()),$("#select_indicador_secundario"+MARC_OBJECT_ARRAY.length).val(i.getIndicadorSecundarioDato());new subcampo_marc_conf(s[d]);var A=i.getSubCamposArray();r="MARC_content_"+n;for(var u=0;u<A.length;u++)A[u].idCompCliente="id_componente_"+generarIdComponente(),A[u].marc_group=r,A[u].posCampo=MARC_OBJECT_ARRAY.length,A[u].posSubCampo=u,procesarSubCampo(A[u],r);MARC_OBJECT_ARRAY.push(i),o+="</div>",o+="</div>",o="<script type='text/javascript'>toggle_component('trigger_"+n+"','MARC_content_"+n+"');<\/script>",$("#marc_group"+n).append(o)}1!=s.length&&_setFoco(),0==MODIFICAR&&2==_NIVEL_ACTUAL&&(_seleccionarTipoDocumentoYDeshabilitarCombo(),$("#"+_getIdComponente("910","a")).val($("#tipo_nivel3_id").val())),1==MODIFICAR&&$("#tipo_nivel3_id").change(function(){$("#"+_getIdComponente("910","a")).val($("#tipo_nivel3_id").val())})}function crearBotonAyudaCampo(e,a){var o="<div class='btn-group inline'><a class='btn click' onclick="+("ayudaParaCampo('"+e+"')")+" title='Info'><i class='icon-info-sign'></i></a>";return o+="</div>"}function crearBotonEsquema(){return"<a class='btn btn-primary click' title='Cambiar el esquema' onclick='open_esquema();' > Esquema</a>"}function crearBotonAgregarEjemplares(e,a){return"<a class='btn btn-success click' title='"+ADD_EJEMPLARES+"' onclick=agregarN3("+e+",'"+a+"'); completarArgregarN3(); ><i class='icon-white icon-plus-sign'></i> "+ADD_EJEMPLARES+"</a>"}function crearBotonAgregarEdicion(e,a){return"<a class='btn btn-success click' title='"+ADD_EDICION+"' onclick=agregarN3("+e+",'"+a+"'); completarArgregarN3(); ><i class='icon-white icon-plus-sign'></i> "+ADD_EDICION+"</a>"}function ayudaParaCampo(e){objAH=new AjaxHelper(updateAyudaParaCampo),objAH.debug=!0,objAH.showOverlay=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="SHOW_AYUDA_MARC",objAH.campo=e,objAH.sendToServer()}function updateAyudaParaCampo(e){$("#ayudaMARC").html(e),$("#ayudaMARC").modal("show")}function generarOpcionesParaSelect(e){for(var a,o=0;o<e.length;o++)a=a+"<option value='"+e[o].clave+"'>"+e[o].valor+"</option>\n";return a}function crearSelectIndicadoresPrimarios(e,a){var o=e.getIndicadoresPrimarios(),t="";return o.length>0&&(t="<select id='select_indicador_primario"+a+"'>"+generarOpcionesParaSelect(o)+"</select>"),t}function crearSelectIndicadoresSecundarios(e,a){var o=e.getIndicadoresSecundarios(),t="";return o.length>0&&(t="<select id='select_indicador_secundario"+a+"'>"+generarOpcionesParaSelect(o)+"</select>"),t}function procesarSubCampo(e,a){TAB_INDEX++;var o,t,r=new subcampo_marc_conf(e),i=r.getVistaIntra(),n=r.getTipo(),l=crearDivComponente("div"+r.getIdCompCliente()),c=r.getTieneEstructura(),s="div_control"+r.getIdCompCliente(),d="<div id='"+s+"' class=control-group>";if("1"==r.getObligatorio()&&(i+="<b> * </b>"),"0"==r.getTieneEstructura()?(i="<div class='divComponente' style='float:left'><input type='text' id='"+r.getIdCompCliente()+"' value='"+r.getDato()+"' size='55' disabled></div>",i+=crearIconWarning(r),i+=crearBotonEliminarSubcampo(r),c=0,o=crearDivLabel(r.getCampo()+"^"+r.getSubCampo()+" - "+r.getVistaIntra(),r.getIdCompCliente()),t="<span id='LI"+r.getIdCompCliente()+"'> "+d+o+"<div class=controls>"+i+"</div></div></span>"):(o=crearDivLabel(i=r.getCampo()+"^"+r.getSubCampo()+" - "+i,r.getIdCompCliente()),t="<span id='LI"+r.getIdCompCliente()+"'> "+d+o+"<div class=controls>"+l+"</div></div></span>"),$("#"+a).append(t),1==c){switch(n){case"text":crearText(r);break;case"combo":crearCombo(r);break;case"texta":crearTextArea(r);break;case"auto":crearAuto(r);break;case"calendar":crearCalendar(r);break;case"anio":crearTextAnio(r);break;case"rango_anio":crearTextRangoAnio(r)}"1"==e.obligatorio&&(hacerComponenteObligatoria(r.getIdCompCliente()),$("#"+s).addClass("error"))}}function addRules(){for(var e=0;e<MARC_OBJECT_ARRAY.length;e++)for(var a=MARC_OBJECT_ARRAY[e].getSubCamposArray(),o=0;o<a.length;o++)if(""!=a[o].rules){create_rules_object(a[o].rules);try{$("#"+a[o].getIdCompCliente()).rules("remove"),$("#"+a[o].getIdCompCliente()).rules("add",RULES_OPTIONS)}catch(e){alert_showed||(closeModal(),bootbox.dialog("Hubo un problema en la estructura del catalogo",{label:"Aceptar",class:"btn-warning",callback:function(){alert_showed=!0}}),alert_showed=!0)}}}function create_rules_object(e){var a,o,t,r=e.split("|");for(RULES_OPTIONS=[],i=0;i<r.length;i++)switch(a=r[i].split(":"),o=$.trim(a[0]),t=$.trim(a[1]),o){case"minlength":RULES_OPTIONS.minlength=t;break;case"maxlength":RULES_OPTIONS.maxlength=t;break;case"digits":RULES_OPTIONS.digits=t;break;case"lettersonly":RULES_OPTIONS.lettersonly=t;break;case"alphanumeric":RULES_OPTIONS.alphanumeric=t;break;case"alphanumeric_total":RULES_OPTIONS.alphanumeric_total=t;break;case"date":RULES_OPTIONS.date=t;break;case"dateITA":RULES_OPTIONS.dateITA=t;break;case"solo_texto":RULES_OPTIONS.solo_texto=t;break;case"rango_anio":RULES_OPTIONS.rango_anio=t,jQuery.validator.addMethod("rango_anio",function(e,a){return this.optional(a)||/^([0-9]{4}-([0-9]{4})?)/.test(e)},"Ingrese un rango de a√±os v√°lido (1979-2000)")}}function _cambiarIdDeAutocomplete(){for(var e=0;e<MARC_OBJECT_ARRAY.length;e++)"auto"==MARC_OBJECT_ARRAY[e].tipo&&(MARC_OBJECT_ARRAY[e].idCompCliente=MARC_OBJECT_ARRAY[e].idCompCliente+"_hidden",$("#"+MARC_OBJECT_ARRAY[e].idCompCliente).val(MARC_OBJECT_ARRAY[e].datoReferencia))}function _cearAutocompleteParaCamponente(e){switch(e.getReferenciaTabla()){case"autor":CrearAutocompleteAutores({IdInput:e.getIdCompCliente(),IdInputHidden:e.getIdCompCliente()+"_hidden"});break;case"pais":CrearAutocompletePaises({IdInput:e.getIdCompCliente(),IdInputHidden:e.getIdCompCliente()+"_hidden"});break;case"lenguaje":CrearAutocompleteLenguajes({IdInput:e.getIdCompCliente(),IdInputHidden:e.getIdCompCliente()+"_hidden"});break;case"ciudad":CrearAutocompleteCiudades({IdInput:e.getIdCompCliente(),IdInputHidden:e.getIdCompCliente()+"_hidden"});break;case"ui":CrearAutocompleteUI({IdInput:e.getIdCompCliente(),IdInputHidden:e.getIdCompCliente()+"_hidden"});break;case"tema":CrearAutocompleteTemas({IdInput:e.getIdCompCliente(),IdInputHidden:e.getIdCompCliente()+"_hidden"});break;case"editorial":CrearAutocompleteEditoriales({IdInput:e.getIdCompCliente(),IdInputHidden:e.getIdCompCliente()+"_hidden"});break;case"nivel2":CrearAutocompleteNivel2({IdInput:e.getIdCompCliente(),IdInputHidden:e.getIdCompCliente()+"_hidden",callBackFunction:buscarDatosNivel2})}}function buscarDatosNivel2(){objAH=new AjaxHelper(updateBuscarDatosNivel2),objAH.debug=!0,objAH.showOverlay=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.tipoAccion="BUSQUEDA_EDICIONES",objAH.id1=$("#"+_getIdComponente("773","a")+"_hidden").val(),objAH.sendToServer()}function updateBuscarDatosNivel2(e){var a=_getIdComponente("773","a");$("#ediciones").html(e),$("#"+a+"_hidden").val($("#edicion_id").val()),$("#edicion_id").change(function(){$("#"+a+"_hidden").val($("#edicion_id").val())})}function generarIdComponente(){return ID_COMPONENTE++}function cloneSubCampo(e){var a=generarIdComponente(),o=_getSubCampoMARC_conf_ById(e),t=copy(o);t.setIdCompCliente(a),procesarSubCampo(t,o.marc_group),MARC_OBJECT_ARRAY[o.posCampo].getSubCamposArray().push(t)}function cloneCampo(e){var a=generarIdComponente(),o=_getCampoMARC_conf_ById(e),t=copy(o);t.setIdCompCliente(a),t.setFirst(!1);for(var r=o.getSubCamposArray(),i=new Array,n=0;n<r.length;n++){var l;(l=copy(r[n])).setIdCompCliente(generarIdComponente()),l.posCampo=o.posCampo,l.setFirst(!1),i.push(l)}t.subcampos_hash=copy(t.getSubCamposHash()),t.setSubCamposArray(i);var c=new Array;c.push(t),procesarInfoJson(c,e)}function removeCampo(e){var a=_getIndexCampoMARC_conf_ById(e),o=a,t=a;$("#"+e).remove(),removeFromArray(MARC_OBJECT_ARRAY,o,t)}function removeSubcampo(e){var a=_getSubCampoMARC_conf_ById(e),o=_getPosBySubCampoMARC_conf_ById(e),t=o;$("#LI"+e).remove(),removeFromArray(MARC_OBJECT_ARRAY[a.posCampo].getSubCamposArray(),o,t)}function openDivButtonContainer(e,a){var o="btn btn-info ",t="btn btn-info dropdown-toggle ",r="Campo";return"campo"!=a&&(o="btn ",t="btn dropdown-toggle ",r="Subcampo"),'<div class="btn-group" style="float: right; margin-left: 5px;" id="'+e+'"><a class="'+o+'"><i class="icon white user"></i> '+r+'</a><a class="'+t+'" data-toggle="dropdown" ><span class="caret"></span></a><ul class="dropdown-menu" id="'+e+'_lista"></ul></div>'}function closeDivButtonContainer(e){return"</ul></div>"}function crearBotonAgregarSubcampoRepetible(e){return"1"==e.getRepetible()?'<li><a class="click" onclick=cloneSubCampo("'+e.getIdCompCliente()+'")><i class="icon-plus"></i> Agregar</a></li>':""}function crearBotonEliminarSubcampoRepetible(e){return"1"==e.getRepetible()?'<li><a class="click" onclick=removeSubcampo("'+e.getIdCompCliente()+'")><i class="icon-trash"></i> Eliminar</a></li>':""}function crearBotonEliminarSubcampo(e){return'<a class="click btn btn-danger" onclick=removeSubcampo("'+e.getIdCompCliente()+'")><i class="icon-trash"></i> Eliminar</a></li>'}function crearIconWarning(e){return"<div style='float:left; margin-left:5px'><span class='label label-info'>Sin estructura</span></div>"}function crearBotonAgregarCampoRepetible(e,a){return"1"==e.getRepetible()?"<li><a class='click' onclick=cloneCampo('"+a+"')><i class='icon-plus'></i> Agregar</a></li>":""}function crearBotonEliminarCampoRepetible(e,a){return display="none",a||(display="block"),"1"==e.getRepetible()?'<li id="boton_eliminar_'+e.getIdCompCliente()+'" style= "display:'+display+'"><a class="click" onclick=removeCampo("'+e.getIdCompCliente()+'")><i class="icon-trash"></i> Eliminar</a></li>':""}function campo_marc_conf(e){function a(){return this.idCompCliente}function o(e){this.idCompCliente=e}function t(){return this.campo}function r(){return this.nombre}function i(){return this.ayuda_campo}function n(){return $.trim(this.descripcion_campo)}function l(){return this.subcampos_array}function c(){return this.subcampos_hash}function s(e){this.subcampos_array=e}function d(){return this.repetible}function A(){return this.indicador_primario}function u(){return this.indicador_secundario}function l(){return this.subcampos_array}function _(){return this.indicadores_primarios}function p(){return this.indicadores_secundarios}function m(){return void 0==this.indicador_primario_dato?"#":this.indicador_primario_dato}function b(){return void 0==this.indicador_secundario_dato?"#":this.indicador_secundario_dato}function C(){return this.first}function g(e){this.first=e}this.nombre=e.nombre,this.campo=e.campo,this.idCompCliente=e.idCompCliente,this.ayuda_campo=e.ayuda_campo,this.descripcion_campo=e.descripcion_campo,this.subcampos_array=e.subcampos_array,this.repetible=e.repetible,this.indicador_primario=e.indicador_primario,this.indicador_secundario=e.indicador_secundario,this.subcampos_array=new Array,this.subcampos_hash=new Object,this.indicadores_primarios=e.indicadores_primarios,this.indicadores_secundarios=e.indicadores_secundarios,this.indicador_primario_dato=e.indicador_primario_dato,this.indicador_secundario_dato=e.indicador_secundario_dato,this.first=!0;for(var I=0;I<e.subcampos_array.length;I++){var R=new subcampo_marc_conf(e.subcampos_array[I]);this.subcampos_array[I]=R}this.getCampo=t,this.getIdCompCliente=a,this.setIdCompCliente=o,this.getNombre=r,this.getAyudaCampo=i,this.getDescripcionCampo=n,this.getSubCamposArray=l,this.getRepetible=d,this.getIndicadorPrimario=A,this.getIndicadorSecundario=u,this.getSubCamposArray=l,this.getSubCamposHash=c,this.setSubCamposArray=s,this.getIndicadoresPrimarios=_,this.getIndicadoresSecundarios=p,this.getIndicadorPrimarioDato=m,this.getIndicadorSecundarioDato=b,this.getFirst=C,this.setFirst=g}function subcampo_marc_conf(e){function a(){return this.idCompCliente}function o(e){this.idCompCliente=e}function t(){return this.campo}function r(){return this.subcampo}function i(){return data_sanitize(this.dato)}function n(e){this.dato=data_sanitize(e)}function l(){return $.trim(data_sanitize(this.datoReferencia))}function c(e){this.datoReferencia=data_sanitize(e)}function s(){return $.trim(this.tipo)}function d(){return $.trim(this.edicion_grupal)}function A(){return $.trim(this.referencia)}function u(){return this.repetible}function _(){return this.referenciaTabla}function p(){return this.opciones}function m(){return this.default_value}function b(){return this.tiene_estructura}function C(){return this.obligatorio}function g(){return $.trim(this.liblibrarian)}function I(){return $.trim(this.ayuda_campo)}function R(){return $.trim(this.descripcion_subcampo)}function E(){return this.first}function v(e){this.first=e}this.liblibrarian=e.liblibrarian,this.itemtype=e.itemtype,this.campo=e.campo,this.subcampo=e.subcampo,this.dato=data_sanitize(e.dato),this.nivel=e.nivel,this.rules=e.rules,this.tipo=e.tipo,this.intranet_habilitado=e.intranet_habilitado,this.tiene_estructura=e.tiene_estructura,this.visible=e.visible,this.edicion_grupal=e.edicion_grupal,this.repetible=e.repetible,this.referencia=e.referencia,this.obligatorio=e.obligatorio,this.datoReferencia=data_sanitize(e.datoReferencia),this.idCompCliente=e.idCompCliente,this.referenciaTabla=e.referenciaTabla,this.opciones=e.opciones,this.defaultValue=e.defaultValue,this.default_value=e.default_value,this.tiene_estructura=e.tiene_estructura,this.ayuda_campo=e.ayuda_campo,this.descripcion_subcampo=e.descripcion_subcampo,this.first=!0,this.getIdCompCliente=a,this.setIdCompCliente=o,this.getCampo=t,this.getSubCampo=r,this.getDato=i,this.setDato=n,this.getDatoReferencia=l,this.setDatoReferencia=c,this.getTipo=s,this.getRepetible=u,this.getReferenciaTabla=_,this.getReferencia=A,this.getOpciones=p,this.getDefaultValue=m,this.getTieneEstructura=b,this.getObligatorio=C,this.getVistaIntra=g,this.getEdicionGrupal=d,this.getAyudaCampo=I,this.getDescripcionSubCampo=R,this.getFirst=E,this.setFirst=v}function crearText(e){null!=e.getDato()&&(dato=e.getDato()),dato=dato.replace(/'/g,"&#039"),dato=dato.replace(/\"/g,"&#034");var a="<input class='input-xlarge' type='text' id='"+e.getIdCompCliente()+"' value='"+dato+"' size='55' tabindex="+TAB_INDEX+" name='"+e.getIdCompCliente()+"' class='horizontal' >";$("#div"+e.getIdCompCliente()).append(a),crearBotones(e)}function crearBotones(e){("1"==e.getRepetible()||e.getReferenciaTabla())&&$(openDivButtonContainer("div_botones"+e.getIdCompCliente())).insertAfter("#div"+e.getIdCompCliente()),"0"==e.getEdicionGrupal()&&1==MODIFICAR&&1==EDICION_N3_GRUPAL?(disableComponent(e.getIdCompCliente()),$("#"+e.getIdCompCliente()).after("<p class='help-block'>No se permite edicion grupal</p>")):($("#div_botones"+e.getIdCompCliente()+"_lista").append(crearBotonAgregarSubcampoRepetible(e)),$("#div_botones"+e.getIdCompCliente()+"_lista").append(crearBotonEliminarSubcampoRepetible(e)),$("#div_botones"+e.getIdCompCliente()+"_lista").append(crearBotonAgregarReferenciaSubcampo(e)))}function crearAyudaComponete(e,a){var o="<p htmlfor='"+e.getIdCompCliente()+"' class='help-block'>"+a+"</p>";$(o).insertAfter("#"+e.getIdCompCliente())}function newCombo(e){var a="<select id='"+e.getIdCompCliente()+"' name='"+e.getIdCompCliente()+"' tabindex="+TAB_INDEX+" class='horizontal'>";a+="<option value=''>Elegir opci&oacute;n</option>\n";for(var o="",t=e.getOpciones(),r=e.getDefaultValue(),i=0;i<t.length;i++)o=e.getDatoReferencia()==t[i].clave||r==t[i].clave&&0==MODIFICAR?o+"<option value='"+t[i].clave+"' selected=selected>"+t[i].valor+"</option>\n":o+"<option value='"+t[i].clave+"' >"+t[i].valor+"</option>\n";return a=a+o+"</select>"}function crearCombo(e){var a=newCombo(e);$("#div"+e.getIdCompCliente()).append(a),crearBotones(e)}function crearTextArea(e){var a="<textarea class='input-xlarge' id='"+e.getIdCompCliente()+"' name='"+e.getIdCompCliente()+"' rows='4' tabindex="+TAB_INDEX+">"+e.getDato()+"</textarea>";$("#div"+e.getIdCompCliente()).append(a),$("#texta"+e.getIdCompCliente()).val(e.getDatoReferencia()),crearBotones(e)}function crearHidden(e){return"<input type='hidden' id='"+e.getIdCompCliente()+"_hidden' name='"+e.getIdCompCliente()+"' value='"+e.getDatoReferencia()+"'>"}function agregarTablaReferencias(e){objAH=new AjaxHelper(updateAgregarTablaReferencias),objAH.showOverlay=!0,objAH.url=URL_PREFIX+"/admin/referencias/referenciasDB.pl",objAH.accion="AGREGAR_REGISTRO",objAH.alias_tabla=e,objAH.sendToServer()}function updateAgregarTablaReferencias(e){$("#basic-modal-content").addClass("bigModal"),$("#basic-modal-content").html(e),$("#basic-modal-content").modal(),crearEditor()}function crearEditor(){var e="";e='<img src="'+imagesForJS+'/loaders/loader_facebook.gif">',makeToggle("datos_tabla_div","trigger",null,!1),onEnter("search_tabla",obtenerTablaFiltrada),$(".editable").editable(URL_PREFIX+"/admin/referencias/referenciasDB.pl",{type:"text",cancel:CANCELAR,submit:OK,tooltip:EDITABLE_MSG,placeholder:EDITABLE_MSG,style:"display: inline",submitdata:{token:"[% token %]",edit:"1"},indicator:e}),$("#tablaResult").attr("style","width: 100%")}function cambiarValorEnHidden(e){var a=$("#edicion_id").val();$(e+"_hidden").val(a)}function crearAuto(e){var a="<input type='text' id='"+e.getIdCompCliente()+"' name='"+e.getIdCompCliente()+"' value='"+e.getDato()+"' size='55' tabindex="+TAB_INDEX+" class='horizontal' >";$("#div"+e.getIdCompCliente()).append(a),crearBotones(e),_cearAutocompleteParaCamponente(e),a=crearHidden(e),$(a).insertAfter("#div"+e.getIdCompCliente())}function crearBotonAgregarReferenciaSubcampo(e){return e.getReferenciaTabla()?'<li><a class="click" onclick=agregarTablaReferencias("'+e.getReferenciaTabla()+'")><i class="icon-plus"></i> Agregar referencia al subcampo '+e.getSubCampo()+" para el campo "+e.getCampo()+"</a></li>":""}function crearCalendar(e){var a="<input class='input-xlarge hasDatepicker' type='text' id='"+e.getIdCompCliente()+"' name='"+e.getIdCompCliente()+"' value='"+e.getDato()+"'' tabindex="+TAB_INDEX+">";$("#div"+e.getIdCompCliente()).append(a),crearBotones(e),$("#div"+e.getIdCompCliente()).datepicker()}function crearTextAnio(e){var a="<input class='input-xlarge' type='text' id='"+e.getIdCompCliente()+"' name='"+e.getIdCompCliente()+"' value='"+e.getDato()+"' size='10' tabindex="+TAB_INDEX+" class='horizontal'>";$("#div"+e.getIdCompCliente()).append(a),crearBotones(e)}function crearTextRangoAnio(e){var a="<input class='input-xlarge' type='text' id='"+e.getIdCompCliente()+"' name='"+e.getIdCompCliente()+"' value='"+e.getDato()+"' size='10' tabindex="+TAB_INDEX+" class='horizontal'>";$("#div"+e.getIdCompCliente()).append(a),crearBotones(e),crearAyudaComponete(e,"un rango de a√±os ej. (1979 - 2000)")}function hacerComponenteObligatoria(e){$("#"+e).addClass("obligatorio"),0==EDICION_N3_GRUPAL&&$("#"+e).addClass("required"),agregarAHash(HASH_MESSAGES,e,ESTE_CAMPO_NO_PUEDE_ESTAR_EN_BLANCO)}function crearDivComponente(e){return"<div id='"+e+"' class='divComponente' style='float: left;'></div>"}function crearDivLabel(e,a){return"<label class='control-label' for='"+a+"'> "+e+" </label>"}function borrarN1(e){bootbox.confirm(ESTA_SEGURO_QUE_DESEA_BORRARLO,function(a){a&&(objAH=new AjaxHelper(updateBorrarN1),objAH.showOverlay=!0,objAH.debug=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.id1=e,objAH.nivel=1,objAH.itemtype=$("#id_tipo_doc").val(),objAH.tipoAccion="ELIMINAR_NIVEL",objAH.sendToServer())})}function updateBorrarN1(e){var a=JSONstring.toObject(e).Message_arrayref;setMessages(a),hayError(a)||(inicializar(),$("#detalleComun").html(""),disableAlert(),$("#ajax-indicator").modal({show:!0,keyboard:!1,backdrop:!1}),window.location="mainpage.pl")}function borrarN2(e){bootbox.confirm(ESTA_SEGURO_QUE_DESEA_BORRARLO,function(a){a&&(objAH=new AjaxHelper(updateBorrarN2),objAH.showOverlay=!0,objAH.debug=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.id2=e,objAH.nivel=2,objAH.itemtype=$("#id_tipo_doc").val(),objAH.tipoAccion="ELIMINAR_NIVEL",objAH.sendToServer())})}function updateBorrarN2(e){var a=JSONstring.toObject(e).Message_arrayref;setMessages(a),hayError(a)||(inicializar(),refreshMeranPage())}function borrarN3(e){bootbox.confirm(ESTA_SEGURO_QUE_DESEA_BORRARLO,function(a){a&&(objAH=new AjaxHelper(updateBorrarN3),objAH.showOverlay=!0,objAH.debug=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.id3_array=[e],objAH.nivel=3,objAH.itemtype=$("#id_tipo_doc").val(),objAH.tipoAccion="ELIMINAR_NIVEL",objAH.sendToServer())})}function updateBorrarN3(e){var a=JSONstring.toObject(e).Message_arrayref;setMessages(a),hayError(a)||(inicializar(),mostrarEstructuraDelNivel3(TEMPLATE_ACTUAL),mostrarInfoAltaNivel2(ID_N2),mostrarInfoAltaNivel3(ID_N2))}function borrarEjemplaresN3(e){var a=new Array;$(".icon_seleccionar:checked").each(function(){a.push($(this).val())}),0==a.length?jAlert("Debe seleccionar al menos un ejemplar","Advertencia de catalogo"):bootbox.confirm(ESTA_SEGURO_QUE_DESEA_BORRARLO,function(o){if(o){objAH=new AjaxHelper(updateBorrarEjemplaresN3),objAH.showOverlay=!0,ID_N2=e,objAH.debug=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl";var t=a;objAH.id3_array=t,objAH.nivel=3,objAH.itemtype=$("#id_tipo_doc").val(),objAH.tipoAccion="ELIMINAR_NIVEL",objAH.sendToServer()}})}function updateBorrarEjemplaresN3(e){var a=JSONstring.toObject(e).Message_arrayref;setMessages(a),hayError(a)||ejemplaresDelGrupo(ID_N2)}function getTemplateString(e){return $("#tipo_nivel3_id").val(TEMPLATE_ACTUAL),$("#tipo_nivel3_id option:selected").val(TEMPLATE_ACTUAL).html()}function modificarN1(e,a){scroll="N1",inicializar(),$("#datos_del_leader").show(),_mostrarAccion("<h4>Modificando el registro ("+(ID_N1=e)+") con el esquema: "+getTemplateString(TEMPLATE_ACTUAL=a)+" ("+TEMPLATE_ACTUAL+")</h4>"+crearBotonEsquema()),objAH=new AjaxHelper(updateModificarN1),objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.showOverlay=!0,objAH.debug=!0,objAH.tipoAccion="MOSTRAR_ESTRUCTURA_DEL_NIVEL_CON_DATOS",objAH.itemtype=TEMPLATE_ACTUAL,objAH.id=ID_N1,objAH.nivel=1,objAH.sendToServer()}function _mostrarAccion(e){$("#estado_accion").html(e),$("#estado_accion").show(),$(".estado_accion").html(e),$(".estado_accion").show()}function updateModificarN1(e){MODIFICAR=1,_NIVEL_ACTUAL=1,updateMostrarEstructuraDelNivel1(e)}function modificarN2(e,a){inicializar(),scroll="N2",ID_TIPO_EJEMPLAR=a,_mostrarAccion("<h4>Modificando el edici&oacute;n ("+(ID_N2=e)+") con el esquema: "+getTemplateString(TEMPLATE_ACTUAL)+" ("+TEMPLATE_ACTUAL+")</h4>"+crearBotonEsquema()+"&nbsp;&nbsp;&nbsp;&nbsp;"+crearBotonAgregarEjemplares(ID_N2,a)),objAH=new AjaxHelper(updateModificarN2),objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.showOverlay=!0,objAH.debug=!0,objAH.tipoAccion="MOSTRAR_ESTRUCTURA_DEL_NIVEL_CON_DATOS",objAH.id=ID_N2,objAH.id_tipo_doc=ID_TIPO_EJEMPLAR,objAH.nivel=2,objAH.sendToServer()}function updateModificarN2(e){MODIFICAR=1,_NIVEL_ACTUAL=2,updateMostrarEstructuraDelNivel2(e)}function modificarN3(e,a){inicializar(),scroll="N3",ID_TIPO_EJEMPLAR=a,_mostrarAccion("<h4>Modificando el ejemplar ("+(ID_N3=e)+") con el esquema: "+getTemplateString(TEMPLATE_ACTUAL)+" ("+TEMPLATE_ACTUAL+")</h4>"+crearBotonEsquema()),objAH=new AjaxHelper(updateModificarN3),objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.debug=!0,objAH.showOverlay=!0,objAH.tipoAccion="MOSTRAR_ESTRUCTURA_DEL_NIVEL_CON_DATOS",objAH.id3=ID_N3,ID3_ARRAY[0]=ID_N3,objAH.nivel=3,objAH.sendToServer()}function updateModificarN3(e){MODIFICAR=1,_NIVEL_ACTUAL=3,$("#divCantEjemplares").hide(),updateMostrarEstructuraDelNivel3(e)}function modificarEjemplaresN3(){seleccionoAlgo("checkEjemplares")&&(inicializar(),objAH=new AjaxHelper(updateModificarEjemplaresN3),objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.debug=!0,objAH.showOverlay=!0,objAH.tipoAccion="MOSTRAR_ESTRUCTURA_DEL_NIVEL_CON_DATOS",objAH.itemtype=$("#id_tipo_doc").val(),ID3_ARRAY=recuperarSeleccionados("checkEjemplares"),objAH.id3=ID3_ARRAY[0],objAH.nivel=3,EDICION_N3_GRUPAL=1,objAH.sendToServer())}function modificarEjemplaresN3FromRegistro(e){ID3_ARRAY.length>0&&(inicializar(),ID_N1=e,objAH=new AjaxHelper(updateModificarEjemplaresN3),objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.debug=!0,objAH.showOverlay=!0,objAH.tipoAccion="MOSTRAR_ESTRUCTURA_DEL_NIVEL_CON_DATOS",objAH.itemtype=$("#id_tipo_doc").val(),objAH.id3=ID3_ARRAY[0],objAH.nivel=3,EDICION_N3_GRUPAL=1,objAH.sendToServer())}function updateModificarEjemplaresN3(e){MODIFICAR=1,$("#divCantEjemplares").hide(),mostrarEstructuraDelNivel3(TEMPLATE_ACTUAL)}function borrarGrupo(e,a){objAH=new AjaxHelper(updateBorrarGrupo),objAH.showOverlay=!0,objAH.debug=!0,objAH.url=URL_PREFIX+"/catalogacion/estructura/estructuraCataloDB.pl",objAH.id2=a,objAH.nivel=2,objAH.itemtype=$("#id_tipo_doc").val(),objAH.tipoAccion="ELIMINAR_NIVEL",objAH.sendToServer()}function updateBorrarGrupo(){}function cargarNivel1(e,a){ID_N1=e.id1,ID_N2=e.id2,"MODIFICAR_NIVEL_2"==e.tipoAccion?(modificarN2(e.id2,a),getNivel2(e.id2)):"MODIFICAR_NIVEL_3"==e.tipoAccion?(modificarN3(e.id3,a),mostrarInfoAltaNivel3(e.id2,a)):(modificarN1(e.id1,a),mostrarInfoAltaNivel1(e.id1,a))}function validateForm(e,a){$.validator.setDefaults({submitHandler:a});LLENE_EL_CAMPO;$().ready(function(){$("#"+e).validate({errorElement:"span",errorClass:"alert alert-error block",messages:HASH_MESSAGES})}),$("#"+e).validate()}function addRegistroAlindice(e){objAH=new AjaxHelper(updateInfoActualizar),objAH.url=URL_PREFIX+"/reports/catalogoDB.pl",objAH.tipoAccion="ADD_REGISTRO_AL_INDICE",objAH.debug=!0,objAH.showOverlay=!0;var a=new Array;a[0]=e,objAH.array_id1=a,objAH.funcion="changePage",objAH.sendToServer()}function updateInfoActualizar(e){var a=JSONstring.toObject(e);setMessages(a),setTimeout(refreshMeranPage,5e3)}var ID_N1=0,ID_N1_PADRE=0,ID_N2=0,ID_N2_PADRE=0,ID_N3=0,ID_TIPO_EJEMPLAR=0,TAB_INDEX=0,MARC_OBJECT_ARRAY=new Array,MODIFICAR=0,ACTION="UNDEFINED",TEMPLATE_ACTUAL=0,EDICION_N3_GRUPAL=0,FROM_DETALLE_REGISTRO=0,ID3_ARRAY=new Array,BARCODES_ARRAY=new Array,_NIVEL_ACTUAL=1,_message=CAMPO_NO_PUEDE_ESTAR_EN_BLANCO,HASH_RULES=new Array,HASH_MESSAGES=new Array,AGREGAR_COMPLETO=1,ID_COMPONENTE=1,scroll="N1",FATAL_ERROR=0,RULES_OPTIONS=[],alert_showed=!1;